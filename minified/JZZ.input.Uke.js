!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t:"function"==typeof define&&define.amd?define("JZZ.input.Uke",["JZZ"],t):t(JZZ)}(function(s){if(s){s.input||(s.input={});for(var n="0.0.3",a=.04,u=.06,p=[.03,.01,-.01,-.03],f=[],t=0;t<25;t++)f.push(1-Math.pow(2,-t/12));var h,r=["C","C♯","D","E♭","E","F","F♯","G","A♭","A","B♭","B"];d.prototype.create=function(){var t,e=function(t){var e,n,r,i=t.params.frets;(t=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttribute("version","1.1"),t.setAttribute("viewBox",[-.25,-.2,.5,1.4].join(" "));var o=document.createElementNS("http://www.w3.org/2000/svg","g");for(t.appendChild(o),o.appendChild(v(-a,0,a,0)),o.appendChild(v(-u,1,u,1)),e=0;e<=i;e++)r=f[e],o.appendChild(v(-(n=a+(u-a)*r),r,n,r));for(o.appendChild(v(-a,0,-n,r)),o.appendChild(v(a,0,n,r)),4<i&&o.appendChild(l(0,(f[4]+f[5])/2)),6<i&&o.appendChild(l(0,(f[6]+f[7])/2)),9<i&&o.appendChild(l(0,(f[9]+f[10])/2)),11<i&&(o.appendChild(l(-.025,(f[11]+f[12])/2)),o.appendChild(l(.025,(f[11]+f[12])/2))),14<i&&o.appendChild(l(0,(f[14]+f[15])/2)),e=0;e<p.length;e++)o.appendChild(v(p[e],0,p[e]*u/a,1));return[t,o]}(this),n=e[0].createSVGPoint(),r=[],i=[];for(this._svg=e[0],this._svgg=e[1],this._finger=r,this._play=r,this._playing=[],t=0;t<4;t++)r[t]=m(),this._svgg.appendChild(r[t]);for(t=0;t<4;t++)i[t]=m(!0),this._svgg.appendChild(i[t]);this.watchButtons=function(t){h=t.buttons},this.mouseUpHandle=w(this,n),this.mouseDownHandle=g(this,n),this._svg.addEventListener("mousedown",this.mouseDownHandle),window.addEventListener("mousedown",this.watchButtons),window.addEventListener("mousemove",this.watchButtons),window.addEventListener("mouseup",this.mouseUpHandle),this.at=this.params.at,"string"==typeof this.at&&(this.at=document.getElementById(this.at));try{this.at.appendChild(this._svg)}catch(t){this.at=document.createElement("div"),document.body.appendChild(this.at),this.at.appendChild(this._svg)}},d.prototype._on=function(t,e){var e=e-this.params.strings[t];this._off(t),0<=e&&e<=this.params.frets&&(e=(f[e=e]+(e?f[e-1]:f[11]-f[12]))/2,this._play[t].setAttribute("cx",p[t]*(1+e*(u/a-1))),this._play[t].setAttribute("cy",e))},d.prototype._off=function(t){this._play[t].setAttribute("cx",100),this._play[t].setAttribute("cy",100)},d.prototype.forward=function(t){for(var e,n=t[1],r=t.getChannel(),i=0;i<4;i++)r==this.params.channels[i]&&(e=i);0<=e&&e<=3&&(t.isNoteOn()?this._on(e,n):t.isNoteOff()&&this._off(e)),this.emit(t)},d.prototype.svg=function(){return this.at.innerHTML},d.prototype.viewbox=function(t,e,n,r){this._svg.setAttribute("viewBox",[t,e,n,r].join(" "))},d.prototype.transform=function(t,e,n,r,i,o){this._svgg.setAttribute("transform","matrix("+[t,e,n,r,i,o].join(" ")+")")},d.prototype.destroy=function(){this.watchButtons&&(this._svg.removeEventListener("mousedown",this.mouseDownHandle),window.removeEventListener("mousedown",this.watchButtons),window.removeEventListener("mousemove",this.watchButtons),window.removeEventListener("mouseup",this.mouseUpHandle)),this.at.removeChild(this._svg)},b.prototype._info=function(t){return{type:"html/javascript",name:(e="Uke",t||e),manufacturer:"virtual",version:n};var e},b.prototype._openIn=function(e,t){var s=new d(this._arg);s.send=function(){e.send.apply(e,arguments)},s.emit=function(t){e._emit(t)},s.connect=function(){e.connect.apply(e,arguments)},s.create(),e._info=this._info(t),e._receive=function(t){s.forward(t)},e._close=function(){s.destroy()},e.svg=function(){return s.svg()},e.viewbox=function(t,e,n,r){return s.viewbox(t,e,n,r)},e.transform=function(t,e,n,r,i,o){return s.transform(t,e,n,r,i,o)},e._resume()},s.input.Uke=function(){var t,e;1==arguments.length?"string"==typeof arguments[0]?t=arguments[0]:e=arguments[0]:(t=arguments[0],e=arguments[1]);var n=new b;return n._arg=e,s.lib.openMidiIn(t,n)},s.input.Uke.version=function(){return n},s.input.Uke.register=function(){var t,e;1==arguments.length?"string"==typeof arguments[0]?t=arguments[0]:e=arguments[0]:(t=arguments[0],e=arguments[1]);var n=new b;return n._arg=e,s.lib.registerMidiIn(t,n)},s.input.Uke.strings=i,s.input.Uke.tuning=function(t){for(var e=[],n=0;n<4;n++)e.push(r[t[3-n]%12]);return t[3]>t[2]&&(e[0]=e[0].toLowerCase()),""+i(e=e.join("-"))==""+t?e:c(t)},s.input.Uke.tuningx=c}function o(t){if(t){var e=t.split("-");return 4==e.length?e:(e=t.split("")).length<4?void 0:4==e.length?e:function t(e,n){if(!n)return e.length?void 0:[];for(var r=1;r<=e.length;r++){var i=e.substr(0,r);if(void 0===s.MIDI.noteValue(i+"9"))break;var o=t(e.substr(r),n-1);if(o)return[i].concat(o)}}(t,4)}}function i(t){var e,n,r=[];if(t=o(t)){for(e=0;e<4;e++){if(void 0===(n=s.MIDI.noteValue(t[3-e]))){if(e)return;break}r.push(n)}if(r.length)return r;for(e=0;e<4;e++){if(void 0===(n=s.MIDI.noteValue(t[e]+"9")))return;r.push(n%12)}for(e=1;e<4;e++)for(;r[e]<r[e-1];)r[e]+=12;var i=53;for(t[0][0]==t[0][0].toLowerCase()&&t[1][0]==t[1][0].toUpperCase()?(r[0]+=12,i=56):r[1]%12==9&&r[2]%12==2&&r[3]%12==7&&(i=33);r[1]<i;)for(e=0;e<4;e++)r[e]+=12;return r.reverse()}}function c(t){for(var e=[],n=0;n<4;n++)e.push(r[t[3-n]%12]+Math.floor(t[3-n]/12));return e.join("-")}function d(t){for(var e in this.params={frets:18,strings:i("gCEA"),channels:[0,1,2,3]},t=void 0===t?{}:t)this.params[e]=t[e];(this.params.frets!=parseInt(this.params.frets)||this.params.frets<1||24<this.params.frets)&&(this.params.frets=18)}function v(t,e,n,r){var i=document.createElementNS("http://www.w3.org/2000/svg","line");return i.setAttribute("x1",t),i.setAttribute("y1",e),i.setAttribute("x2",n),i.setAttribute("y2",r),i.setAttribute("stroke","black"),i.setAttribute("vector-effect","non-scaling-stroke"),i.setAttribute("stroke-width","1px"),i}function l(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","circle");return n.setAttribute("cx",t),n.setAttribute("cy",e),n.setAttribute("r",.005),n.setAttribute("stroke","black"),n.setAttribute("fill","none"),n.setAttribute("vector-effect","non-scaling-stroke"),n.setAttribute("stroke-width","1px"),n}function m(t){var e=document.createElementNS("http://www.w3.org/2000/svg","circle");return e.setAttribute("cx",100),e.setAttribute("cy",100),e.setAttribute("r",.01),e.setAttribute("stroke","black"),t||e.setAttribute("fill","none"),e.setAttribute("vector-effect","non-scaling-stroke"),e.setAttribute("stroke-width","1px"),e}function g(i,o){return function(t){var e,n,r;(void 0===(r=t).buttons?!r.button:1&r.buttons)&&(o.x=t.clientX,o.y=t.clientY,0<=(e=function(t){if(t<f[11]-f[12])return-1;for(var e=0;e<25;e++)if(t<=f[e])return e;return-1}((n=o.matrixTransform(i._svgg.getScreenCTM().inverse())).y))&&e<=i.params.frets&&(r=n.x,n=n.y,0<=(r=(n=a*(1-n)+u*n)<r?-1:.5*n<r?0:0<r?1:.5*-n<r?2:-n<=r?3:-1)&&r<=3&&(i._ps=r,i._pn=e+i.params.strings[r],i.forward(s.MIDI.noteOn(i.params.channels[r],i._pn))))),h=t.buttons}}function w(n,r){return function(t){var e;t=void 0===(e=t).buttons||e.buttons!=h?e:(e.stopPropagation(),0==e.button?{buttons:1^h}:1==e.button?{buttons:4^h}:2==e.button?{buttons:2^h}:void 0),(void 0===(e=t).buttons?e.button:1&e.buttons)||(r.x=t.clientX,r.y=t.clientY,r.matrixTransform(n._svgg.getScreenCTM().inverse()),void 0!==n._ps&&(n.forward(s.MIDI.noteOff(n.params.channels[n._ps],n._pn)),n._ps=void 0,n._pn=void 0)),h=t.buttons}}function b(){}});